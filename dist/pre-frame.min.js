var preframe=function(e,t){"use strict";function s(e,t,s){this.name=e,this._signals="function"==typeof t?["appDb"]:t,this._signalsNames=this._signals.reduce(((e,t,s)=>(e[t]=s,e)),{}),this._extractor="function"==typeof t?t:s,this.subscribers=new Set,this.value,this._updateQueue={},this._triggerUpdate=!0,this._processQueue=this._processQueue.bind(this),"appDb"===e&&(this._signals=[])}s.prototype.subscribe=function(e){return 0===this.subscribers.size?(this.subscribers.add(e),this._signals.forEach((e=>this._updateQueue[e]=i[e].subscribe(this))),this._processQueue(!0)):this.subscribers.add(e),this.value},s.prototype.unsubscribe=function(e){this.subscribers.delete(e),0===this.subscribers.size&&this._signals.forEach((e=>i[e].unsubscribe(this)))},s.prototype._processQueue=function(e){this._triggerUpdate=!0;const t=[];Object.keys(this._updateQueue).forEach((e=>{const s=this._updateQueue[e];t[this._signalsNames[e]]=s}));const s=this._extractor.apply(null,t);s!==this.value&&(this.value=s,e||this.subscribers.forEach((e=>{"update"in e?e.update(this.name,s):e.setState({})})))},s.prototype.update=function(e,t,s){this._updateQueue[e]=t,this._triggerUpdate&&(this._triggerUpdate=!1,queueMicrotask(this._processQueue))};const i={},r=t.options.__r;let n;t.options.__r=e=>{n=e,r&&r(e)};const u={_:{}},c={},a={},o={dispatch:e=>d(...e),db:e=>{u._=e}},p={},h=(e,t)=>c[e]=t;i.appDb=new s("appDb",(e=>e));const b=function(e,t,r){if(1===arguments.length){const s=e.split(".");t=s.length>0?e=>s.reduce(((e,t)=>e[t]),e):t=>t[e]}i[e]=new s(e,t,r)},f=(e,t)=>{i.appDb.update("appDb",e,t)},_=[{after:(e,t)=>{Object.keys(e.effects).forEach((t=>{o[t](e.effects[t])}))}}],d=(e,t)=>{e in c?queueMicrotask((()=>{var s=c[e](t)(u._);u._=s,f(u._)})):e in a&&queueMicrotask((()=>{let s,i=a[e][0],r=a[e][1],n=_.reduce(((e,t)=>"before"in t?t.before(e):e),{event:[e].concat(t),db:u._});Array.isArray(i)?(n=i.reduce(((e,t)=>"before"in t?t.before(e):e),n),s={coeffects:n,effects:r(n,t)},s=i.reduceRight(((e,t)=>"after"in t?t.after(e):e),s)):s={coeffects:n,effects:r(n,t)},_.reduceRight(((e,t)=>"after"in t?t.after(e):e),s),f(u._)}))},l=e=>{const t="__c"in n?n.__c:n._component,s=i[e];if(!s.subscribers.has(t)){t.componentWillUnmount=function(){t.unsubscribe(sub)};return s.subscribe(t)}return s.value},g=(e=u._,t="")=>(Object.keys(e).forEach((s=>{const r=t+s;r in i||b(t+s),r in c||r in a||h(r,(e=>t=>({...t,[r]:e})));const n=e[s];"object"==typeof n&&"Object"===n.constructor.name&&g(n,t+s+".")})),e),y={},v={};return e.$dispatch=e=>e in v?v[e]:v[e]=()=>d(e),e.autoWire=g,e.bind=e=>({onInput:y[e]||(y[e]=t=>d(e,t.target.value)),value:l(e)}),e.dispatch=d,e.dispatchSync=(e,t)=>{if(!(e in c))throw"cannot find registered event";var s=c[e](t)(u._);u._=s,f(u._,!0)},e.injectCofx=e=>({before:p[e]}),e.regCofx=(e,t)=>p[e]=t,e.regEvent=h,e.regEventFx=function(e){let t,s;arguments.length>2?(t=arguments[1],s=arguments[2]):s=arguments[1],a[e]=[t,s]},e.regFx=(e,t)=>o[e]=t,e.regSub=b,e.signalsRegistry=i,e.subscribe=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({},preact);
